#!/usr/bin/env ruby
# frozen_string_literal: true

# Attach to the first warm sprite
# Usage: SPRITES_TOKEN=your-token script/attach

$LOAD_PATH.unshift File.expand_path("../lib", __dir__)
require "sprites"

unless ENV["SPRITES_TOKEN"]
  abort "Set SPRITES_TOKEN environment variable"
end

client = Sprites::Client.new(token: ENV["SPRITES_TOKEN"])

puts "Fetching sprites..."
collection = client.sprites.list

collection.sprites.each do |sprite|
  puts "  - #{sprite.name} (#{sprite.status})"
end

warm_sprite = collection.sprites.find { |s| s.status == "warm" }

unless warm_sprite
  abort "No warm sprites found"
end

puts
puts "Attaching to #{warm_sprite.name}..."
puts

client.exec.interactive(warm_sprite.name, ["bash"])
